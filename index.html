<html>
<head>
    <style>
    body {
        margin: 0;
    }
    button {
        display: block;
    }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/three@0.119.1/build/three.min.js" integrity="sha256-vbZOK9FPLsRs9y5Z5FvqqQJ7R2GEUIFDpEX4W80cLOA=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.119.1/examples/js/controls/OrbitControls.js" integrity="sha256-fAVAfKkgT1N7ZTJgMFUEtYwJH19h+FYKg4NRK4hv74A=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.119.1/examples/js/loaders/GLTFLoader.js" integrity="sha256-S1wnRbf4SoN46EHk8D4Zl2qiagRCO+unaoG6tAEjOuI=" crossorigin="anonymous"></script>
</head>
<body>
    <div style="position: absolute">
        <button onclick="setDesign(randomDesign())">Randomize</button>
        <button onclick="setDesign(semiRandomDesign())">Randomish</button>
        <button onclick="setDesign(semiRandomDesign2())">Randomish 2</button>
        <button onclick="setDesign('000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000010300000000000000000002013000000000000001021323100000000000000101232120000000000020010311310000000002003012322200000000030312220131200000000000103113000100000000000003010000010000000000002013110000000000000000100200001000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000')">Save 1</button>
        <button onclick="setDesign('000000000000000100000000000000000000000000000000000000000000000000000000003200000000000000000321032000000000000002103210300000000000032321032100000000000010103210320000000003212321032100000000001030103210300000000023212321032200000000001030103210200000000000312321210010000000010030103010000000000000002321230001000000000000103000000000000000000021000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000')">Save 2</button>
        <button onclick="setDesign('000000000000000000000000000000000000000000000000000001000000000000000000011020000000000000000110231000000000000001102310200000000000011023102310000000000110231023100000000001102310231020000000011023102310200000000010231023102000000000002310231020000000000000102310200000000000000023102310000000000000001023110000000000000000231000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000')">Save 3</button>
        <button onclick="setDesign('321131122330032210211231201230013201102123002312031201230313230213231301122033123320121021300123131030021330103113031300122132113230120310022303300201021321001313011203312112201223232232031023323023010013203213231023321332330123300312112130210031202301031203122303201230112123301301120312021200230130021232123312301203012233001331203032011231230110232130213122303011320302301220123012031201300112102013032202031032012310230120312323201223011')">Save 4</button>
        <button onclick="setDesign('000000000000000000000000000000000000000000000000000000000000000000000001200000100000000000010222000100000000000003332200000000000000031133220000000000000223113322000000000002223311332200000000000222331133210000000000022233113220000000000002223310101000000000000222210010000000000000022220000000000000000002220001000000000000000201000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000')">Save 5</button>

    </div>
</body>
<script type="text/javascript">
var scene = new THREE.Scene();
var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );

var renderer = new THREE.WebGLRenderer({
    antialias: true
});
renderer.setSize( window.innerWidth, window.innerHeight );
document.body.appendChild( renderer.domElement );

var loader = new THREE.GLTFLoader();
loader.load(
// resource URL
'assets/model.glb',
// called when the resource is loaded
function ( gltf ) {
    scene.add( gltf.scene );
})

var controls = new THREE.OrbitControls( camera, renderer.domElement );
camera.position.set( 0, 10, 10 );
controls.update();

function animate() {
    requestAnimationFrame( animate );
    renderer.render( scene, camera );
}
animate();
</script>

<script type="text/javascript">
const mats = [
new THREE.MeshStandardMaterial({
    map: new THREE.TextureLoader().load('./assets/black_hole.jpg'),
}),
new THREE.MeshStandardMaterial({
    map: new THREE.TextureLoader().load('./assets/cloudy_sand.jpg'),
}),
new THREE.MeshStandardMaterial({
    map: new THREE.TextureLoader().load('./assets/dove_blue.jpg'),
}),
new THREE.MeshStandardMaterial({
    map: new THREE.TextureLoader().load('./assets/serene_grey.jpg'),
}),
];

const PI2 = Math.PI / 2;

const group = new THREE.Group();
group.rotation.y = Math.PI / 4;
scene.add(group);

for (let x = -10; x <= 10; x++) {
    for (let z = -10; z <= 10; z++) {
        let geometry = new THREE.PlaneBufferGeometry();
        let plane = new THREE.Mesh( geometry, mats[0] );
        plane.position.x = x;
        plane.position.y = 0.001;
        plane.position.z = z;
        plane.rotation.x = -PI2;
        let r = Math.abs(z) % 2;
        if (Math.abs(x) % 2) r += 2;
        plane.rotation.z = PI2 * r;
        group.add(plane);
    }
}

const mouse = new THREE.Vector2();

function getMousePos(event) {
    mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
    mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
}

function getTileObjUnderMouse() {
    const raycaster = new THREE.Raycaster();
    raycaster.setFromCamera( mouse, camera );
    const intersects = raycaster.intersectObjects(scene.children, true);
    for (let i of intersects) {
        if (i.object.parent === group) {
            return i.object;
        }
        const m = i.object.material;
        let mi = mats.indexOf(m);
        if (mi === -1) {
            continue;
        } else {
            return i.object;
        }
    }
}

function incrementTileDesign(tileObj) {
    const m = tileObj.material;
    let mi = mats.indexOf(m);
    mi++;
    mi %= 4;
    tileObj.material = mats[mi];
}

renderer.domElement.addEventListener("click", (event) => {
    getMousePos(event);
    const tile = getTileObjUnderMouse();
    if (tile) {
        incrementTileDesign(tile);
        console.log(getDesign());
    }
}, false);

document.addEventListener('mousemove', (event) => {
    getMousePos(event);
});

document.addEventListener('keydown', (event) => {
    const tile = getTileObjUnderMouse();
    if (!tile) return;
    if (event.key === "1") tile.material = mats[0];
    if (event.key === "2") tile.material = mats[1];
    if (event.key === "3") tile.material = mats[2];
    if (event.key === "4") tile.material = mats[3];
    console.log(getDesign());
});

function tileIdxAt(x, z) {
    x += 10;
    z += 10;
    const i = 21 * x + z;
    return i;
}

function tileObjAt(x, z) {
    const i = tileIdxAt(x, z);
    return group.children[i];
}

function tileAt(x, z) {
    const tile = tileObjAt(x, z);
    if (!tile) return 0;
    return mats.indexOf(tile.material);
}

function tileAtDesign(vals, x, z) {
    return parseInt(vals[tileIdxAt(x, z)]);
}

function getDesign() {
    let vals = "";
    for (let i of group.children) {
        vals += mats.indexOf(i.material);
    }
    return vals;
}

function randomDesign() {
    let vals = "";
    for (let i of group.children) {
        vals += Math.floor(Math.random() * Math.floor(4));
    }
    return vals;
}

function semiRandomDesign() {
    let vals = "";
    for (let x = -10; x <= 10; x++) {
        for (let z = -10; z <= 10; z++) {
            const tile = tileObjAt(x, z);
            let v = Math.floor(Math.random() * Math.floor(4));
            while (
                (
                    tileAtDesign(vals, x - 1, z) === v
                    && tileAtDesign(vals, x - 2, z) === v)
                || (
                    tileAtDesign(vals, x, z - 1) === v
                    && tileAtDesign(vals, x, z - 2) === v)
                ) {
                v += 1;
                v %= 4;
            }
            vals += v;
        }
    }
    return vals;
}

function countAdjacent(vals, x, z, v) {
    let r = 0;
    if (tileAtDesign(vals, x - 1, z) === v) r += 1;
    if (tileAtDesign(vals, x - 2, z) === v) r += 1;
    if (tileAtDesign(vals, x, z - 1) === v) r += 1;
    if (tileAtDesign(vals, x, z - 2) === v) r += 1;
    return r;
}

function semiRandomDesign2() {
    let vals = "";
    for (let x = -10; x <= 10; x++) {
        for (let z = -10; z <= 10; z++) {
            const tile = tileObjAt(x, z);
            let v = Math.floor(Math.random() * Math.floor(4));
            while (countAdjacent(vals, x, z, v) > 1) {
                v += 1;
                v %= 4;
            }
            vals += v;
        }
    }
    return vals;
}

function setDesign(vals) {
    let i = 0;
    for (let v of vals) {
        group.children[i].material = mats[parseInt(v)];
        i++;
    }
    console.log(getDesign());
}

</script>
</html>